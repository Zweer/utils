# zweer/utils

![Coverage Badge](https://img.shields.io/badge/coverage-100%25-brightgreen?style=flat)

A collection of utilities and scripts designed to enhance your development experience. This repository aims to provide helpful tools for common development tasks.

## Table of Contents

- [Overview](#overview)
- [Scripts](#scripts)
  - [Coverage Badge Updater (`update-readme-coverage.ts`)](#coverage-badge-updater-update-readme-coveragets)
    - [Purpose](#purpose)
    - [How it Works](#how-it-works)
    - [Prerequisites](#prerequisites)
    - [Usage](#usage)
    - [Badge Color Logic](#badge-color-logic)
- [Testing](#testing)
- [Contributing](#contributing)
- [License](#license)

## Overview

This repository contains various scripts and utilities. The primary goal is to simplify repetitive tasks and integrate useful automation into development workflows.

## Scripts

### Coverage Badge Updater (`update-readme-coverage.ts`)

This TypeScript script automatically updates a Shields.io coverage badge in your `README.md` file based on the coverage summary generated by your test runner (e.g., Vitest, Jest with Istanbul).

#### Purpose

To keep your project's coverage badge in sync with the actual test coverage without manual intervention. This provides an up-to-date visual indicator of your project's test health directly in your README.

#### How it Works

1.  **Reads Coverage Data**: It parses the `coverage/coverage-summary.json` file to find the total line coverage percentage.
2.  **Rounds Percentage**: The coverage percentage is rounded to the nearest whole number.
3.  **Determines Color**: A color for the badge (e.g., `brightgreen`, `yellow`, `red`) is selected based on the rounded coverage percentage.
4.  **Finds Badge in README**: It uses a regular expression to locate the existing coverage badge in your `README.md` file. The expected badge format is:
    `![Coverage Badge](https://img.shields.io/badge/coverage-XX%25-COLOR?style=flat)`
5.  **Updates Badge**: The script replaces the old percentage and color in the badge URL with the newly calculated values.
6.  **Writes to README**: The `README.md` file is overwritten with the updated content.
7.  **Logs Outcome**: It logs a success message to the console or an error if the badge isn't found or if files are missing.

#### Prerequisites

*   **Node.js**: Required to run the script.
*   **Coverage Summary**: Your project must generate a `coverage-summary.json` file in a `coverage/` directory at the project root. This is a standard output for tools like Istanbul, used by Jest and Vitest for coverage reporting.
*   **Existing Badge**: Your `README.md` must contain a Shields.io coverage badge matching the specific pattern:
    `![Coverage Badge](https://img.shields.io/badge/coverage-XX%25-COLOR?style=flat)`
    (Where `XX` is a number and `COLOR` is a valid Shields.io color name).

#### Usage

1.  **Place the script**: Put `update-readme-coverage.ts` in your project, for example, in a `scripts/` directory.
2.  **Install dependencies** (if you haven't already for TypeScript execution):
    ```bash
    npm install -D typescript ts-node
    # or
    yarn add -D typescript ts-node
    # or
    pnpm add -D typescript ts-node
    ```
3.  **Run the script**: Execute it after your test coverage has been generated.
    ```bash
    npx ts-node path/to/your/scripts/update-readme-coverage.ts
    ```
    For example, if the script is at `./scripts/update-readme-coverage.ts`:
    ```bash
    npx ts-node ./scripts/update-readme-coverage.ts
    ```

4.  **Integrate with `package.json`** (recommended):
    Add it to your npm scripts to run automatically after tests.
    ```json
    // package.json
    {
      "scripts": {
        "test": "vitest run --coverage", // Or your test command that generates coverage
        "update-badge": "npx ts-node ./scripts/update-readme-coverage.ts",
        "test:badge": "npm run test && npm run update-badge"
      }
    }
    ```
    Now you can run `npm run test:badge` or integrate `npm run update-badge` into your CI pipeline.

#### Badge Color Logic

The script updates the badge color based on the **rounded** total line coverage percentage:

| Coverage        | Color         |
| :-------------- | :------------ |
| `> 98%`         | `brightgreen` |
| `> 95%`         | `green`       |
| `> 90%`         | `yellow`      |
| `> 80%`         | `yellowgreen` |
| `> 50%`         | `orange`      |
| `>= 0%`         | `red`         |
| Otherwise (e.g., <0) | `grey`        |

## Testing

The `update-readme-coverage.ts` script includes a comprehensive test suite using [Vitest](https://vitest.dev/). The tests mock file system operations and other side effects to ensure the script's logic is verified in isolation.

To run the tests:

```bash
npm test
# or if you prefer to call vitest directly
npx vitest run
```

The test file is named `update-readme-coverage.test.ts` and should be located alongside the script or in a `__tests__` directory, depending on your project structure.

## Contributing

Contributions are welcome! If you have ideas for new utilities, improvements to existing ones, or bug fixes, please feel free to:

1.  Fork the repository.
2.  Create a new branch (`git checkout -b feature/your-feature-name`).
3.  Make your changes.
4.  Ensure tests pass (and add new ones for new features).
5.  Commit your changes (`git commit -am 'Add some feature'`).
6.  Push to the branch (`git push origin feature/your-feature-name`).
7.  Create a new Pull Request.

## License

This project is licensed under the MIT License - see the [LICENSE.md](LICENSE.md) file for details (or you can specify your license here).
